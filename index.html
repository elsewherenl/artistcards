<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events Calendar - Elsewhere Collective</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Satoshi:wght@300;400;500;600;700&display=swap');
        
        :root {
            --biscuit-gold: #D6B370;
            --dark-bg: #0D0D0D;
            --off-white: #F3EFE9;
            --text-dark: #0D0D0D;
            --text-gray: #666;
            --text-light: #888888;
            --border-light: rgba(214, 179, 112, 0.2);
            --peach: #CB9D8E;
            --vibrant-orange: #DF6733;
            --chartreuse: #B8FF60;
            --lapis-blue: #2552FF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Satoshi', sans-serif;
            background: var(--dark-bg);
            color: var(--off-white);
            line-height: 1.6;
            overflow-x: auto;
        }

        .header {
            padding: 2rem;
            border-bottom: 1px solid rgba(243, 239, 233, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .brand {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1rem;
            font-weight: 400;
            letter-spacing: 0.02em;
        }

        .year {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1rem;
            color: var(--text-light);
            font-weight: 300;
        }

        .hero-section {
            padding: 4rem 2rem 2rem;
            text-align: left;
        }

        .hero-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 300;
            letter-spacing: -0.02em;
            margin-bottom: 2rem;
            line-height: 0.9;
        }

        .hero-subtitle {
            font-family: 'Satoshi', sans-serif;
            font-size: 1.1rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
            font-weight: 400;
        }

        .hero-description {
            font-family: 'Satoshi', sans-serif;
            font-size: 1.1rem;
            color: var(--text-light);
            font-weight: 400;
        }

        .legend {
            padding: 0 2rem 2rem;
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 400;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .priority-key { background: var(--chartreuse); }
        .priority-important { background: var(--vibrant-orange); }
        .priority-optional { background: var(--peach); }

        .calendar-scroll {
            overflow-x: auto;
            padding-bottom: 1rem;
        }

        .calendar-container {
            display: grid;
            grid-template-columns: repeat(12, minmax(350px, 1fr));
            gap: 1.5rem;
            padding: 2rem;
            min-width: max-content;
        }

        .month-column {
            background: rgba(243, 239, 233, 0.03);
            border: 1px solid rgba(243, 239, 233, 0.1);
            border-radius: 4px;
            min-height: 600px;
            transition: all 0.3s ease;
        }

        .month-column:hover {
            background: rgba(243, 239, 233, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .month-header {
            background: var(--biscuit-gold);
            color: var(--text-dark);
            padding: 1rem;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 500;
            font-size: 1rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            text-align: center;
            border-radius: 4px 4px 0 0;
        }

        .month-content {
            padding: 1.5rem;
            height: calc(100% - 60px);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .planning-block {
            background: rgba(214, 179, 112, 0.1);
            border-left: 3px solid var(--biscuit-gold);
            padding: 1rem;
            border-radius: 0 4px 4px 0;
            margin-bottom: 1rem;
        }

        .planning-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--biscuit-gold);
        }

        .planning-subtitle {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .planning-details {
            font-size: 0.75rem;
            color: var(--text-light);
            line-height: 1.4;
        }

        .event {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            padding: 1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .event:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(3px);
        }

        .event::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
        }

        .event[data-priority="key"]::before { background: var(--chartreuse); }
        .event[data-priority="important"]::before { background: var(--vibrant-orange); }
        .event[data-priority="optional"]::before { background: var(--peach); }

        .event-name {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--off-white);
            line-height: 1.2;
        }

        .event-location {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .event-description {
            font-size: 0.75rem;
            color: var(--text-gray);
            line-height: 1.4;
        }

        .event-date {
            font-size: 0.8rem;
            color: var(--biscuit-gold);
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .event-website {
            font-size: 0.7rem;
            color: var(--lapis-blue);
            margin-top: 0.5rem;
            opacity: 0.8;
            display: inline-block;
            text-decoration: none;
        }
        .event-website:hover { text-decoration: underline; }

        .multi-month-event {
            border-left: 3px dashed var(--biscuit-gold) !important;
            opacity: 0.9;
        }

        .multi-month-event::after {
            content: '';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 8px;
            height: 8px;
            background: var(--biscuit-gold);
            border-radius: 50%;
            opacity: 0.6;
        }

        /* Special large events */
        .featured-event {
            background: linear-gradient(135deg, rgba(214, 179, 112, 0.15), rgba(214, 179, 112, 0.05));
            border: 2px solid rgba(214, 179, 112, 0.3);
            min-height: 150px;
        }

        .featured-event .event-name {
            font-size: 1.1rem;
            color: var(--biscuit-gold);
        }

        .featured-event .event-date {
            font-size: 0.8rem;
            color: var(--biscuit-gold);
        }

        /* Controls */
        .controls {
            padding: 1rem 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            border-bottom: 1px solid rgba(243, 239, 233, 0.1);
        }

        .filter-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--light-bg);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Satoshi', sans-serif;
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .filter-btn.active {
            background: var(--biscuit-gold);
            color: var(--text-dark);
            border-color: var(--biscuit-gold);
        }

        .add-event-btn {
            background: var(--biscuit-gold);
            color: var(--text-dark);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            font-family: 'Satoshi', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .add-event-btn:hover {
            background: #c5a863;
            transform: translateY(-1px);
        }

        /* Event Editor Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a1a;
            border: 1px solid rgba(243, 239, 233, 0.2);
            border-radius: 8px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--biscuit-gold);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.9rem;
            color: var(--off-white);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 0.75rem;
            color: var(--off-white);
            font-family: 'Satoshi', sans-serif;
            font-size: 0.9rem;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--biscuit-gold);
            box-shadow: 0 0 0 2px rgba(214, 179, 112, 0.2);
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-family: 'Satoshi', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background: var(--biscuit-gold);
            color: var(--text-dark);
        }

        .btn-primary:hover {
            background: #c5a863;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--off-white);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-danger {
            background: #ff4444;
            color: white;
        }

        .btn-danger:hover {
            background: #cc3333;
        }

        @media (max-width: 768px) {
            .calendar-container {
                grid-template-columns: repeat(12, minmax(280px, 1fr));
                padding: 1rem;
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
            
            .controls {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="brand">Elsewhere Collective‚Ñ¢</div>
        <div class="year">2025</div>
    </div>

    <div class="hero-section">
        <h1 class="hero-title">Calendar of events</h1>
        <p class="hero-subtitle">Focus on Dutch events for regular content creation.</p>
        <p class="hero-description">Target 2 - 3 major European events to build authority.</p>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-dot priority-key"></div>
            <span>Key</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot priority-important"></div>
            <span>Important</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot priority-optional"></div>
            <span>Optional</span>
        </div>
    </div>

    <div class="controls">
        <button class="filter-btn active" data-filter="all">All Events</button>
        <button class="filter-btn" data-filter="key">Key</button>
        <button class="filter-btn" data-filter="important">Important</button>
        <button class="filter-btn" data-filter="optional">Optional</button>
        <button class="add-event-btn" onclick="openEventModal()">+ Add Event</button>
        <button class="add-event-btn" onclick="exportData()" style="background: var(--lapis-blue);">Export Data</button>
        <button class="add-event-btn" onclick="resetData()" style="background: var(--vibrant-orange);">Reset to Defaults</button>
    </div>

    <div class="calendar-scroll">
        <div class="calendar-container" id="calendar">
            <!-- Months will be generated by JavaScript -->
        </div>
    </div>

    <!-- Event Editor Modal -->
    <div class="modal" id="eventModal">
        <div class="modal-content">
            <h2 class="modal-title">Add Event</h2>
            <form id="eventForm">
                <div class="form-group">
                    <label class="form-label">Event Name</label>
                    <input type="text" class="form-input" id="eventName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-input" id="eventLocation" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="text" class="form-input" id="eventDate" placeholder="e.g., Sept 15-18">
                </div>
                <div class="form-group">
                    <label class="form-label">Month</label>
                    <select class="form-select" id="eventMonth" required>
                        <option value="">Select Month</option>
                        <option value="0">August 2025</option>
                        <option value="1">September 2025</option>
                        <option value="2">October 2025</option>
                        <option value="3">November 2025</option>
                        <option value="4">December 2025</option>
                        <option value="5">January 2026</option>
                        <option value="6">February 2026</option>
                        <option value="7">March 2026</option>
                        <option value="8">April 2026</option>
                        <option value="9">May 2026</option>
                        <option value="10">June 2026</option>
                        <option value="11">July 2026</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Priority</label>
                    <select class="form-select" id="eventPriority" required>
                        <option value="">Select Priority</option>
                        <option value="key">Key</option>
                        <option value="important">Important</option>
                        <option value="optional">Optional</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Website (optional)</label>
                    <input type="url" class="form-input" id="eventWebsite" placeholder="https://example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="eventDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="eventFeatured" style="margin-right: 0.5rem;">
                        Featured Event (larger display)
                    </label>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Add Event</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEventModal()">Cancel</button>
                    <button type="button" class="btn btn-danger" id="deleteBtn" onclick="deleteEvent()" style="display: none;">Delete</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Initial events data (immutable default)
        const defaultEventsData = {
            0: { // August 2025
                events: [
                    {
                        id: 'aug1',
                        name: "Fotografia Calabria Festival",
                        location: "Calabria, Italy",
                        date: "Aug 1 - Oct 12",
                        description: "Photography festival in southern Italy",
                        priority: "optional",
                        featured: false,
                        website: "https://www.fotografiacalabria.it/",
                        multiMonth: [0, 1, 2] // Aug, Sep, Oct
                    },
                    {
                        id: 'aug2',
                        name: "PhEST",
                        location: "Monopoli, Italy",
                        date: "Aug - Nov 16",
                        description: "Photography festival in southern Italy",
                        priority: "optional",
                        featured: false,
                        website: "https://www.phest.info/",
                        multiMonth: [0, 1, 2, 3] // Aug, Sep, Oct, Nov
                    }
                ]
            },
            1: { // September 2025
                events: [
                    {
                        id: 'sep2',
                        name: "Berlin Art Week",
                        location: "Berlin",
                        date: "Sept 11-15",
                        description: "Gallery openings and fairs across the city",
                        priority: "important",
                        website: "https://berlinartweek.de/en/",
                        featured: false
                    },
                    {
                        id: 'sep3',
                        name: "Viennacontemporary",
                        location: "Vienna",
                        date: "Sept 11-14",
                        description: "Central European art fair",
                        priority: "optional",
                        website: "https://www.viennacontemporary.at/en/",
                        featured: false
                    }
                ]
            },
            2: { // October 2025
                events: [
                    {
                        id: 'oct1',
                        name: "Dutch Design Week",
                        location: "Eindhoven",
                        date: "Oct 18-26",
                        description: "Innovation showcase, tech-art crossover networking",
                        priority: "key",
                        website: "https://ddw.nl/",
                        featured: false
                    },
                    {
                        id: 'oct2',
                        name: "Frieze London",
                        location: "London",
                        date: "Oct 9-13",
                        description: "Contemporary art fair",
                        priority: "important",
                        website: "https://www.frieze.com/fairs/frieze-london-frieze-masters",
                        featured: false
                    },
                    {
                        id: 'oct3',
                        name: "Brighton Photo Fringe",
                        location: "Brighton",
                        date: "Oct 1-31",
                        description: "Open festival for photography",
                        priority: "optional",
                        featured: false,
                        website: "https://photofringe.org/"
                    }
                ]
            },
            3: { // November 2025
                events: [
                    {
                        id: 'nov1',
                        name: "Paris Photo Fair",
                        location: "Paris",
                        date: "Nov 13-16",
                        description: "World's largest photography fair, networking opportunity",
                        priority: "key",
                        website: "https://www.parisphoto.com/en-gb/exhibitor/exhibitors_2025.html",
                        featured: true
                    },
                    {
                        id: 'nov2',
                        name: "Mois de la Photo",
                        location: "Paris",
                        date: "November",
                        description: "City-wide photography events throughout November",
                        priority: "optional",
                        featured: false
                        // No website provided, leave as is
                    },
                    {
                        id: 'nov3',
                        name: "Woolwich Art Fair",
                        location: "London",
                        date: "Nov 13-16",
                        description: "Contemporary art fair focusing on emerging artists",
                        priority: "important",
                        website: "https://woolwichprintfair.com/",
                        featured: false
                    },
                    {
                        id: 'nov4',
                        name: "Head On Festival",
                        location: "Sydney, Australia",
                        date: "Nov 7-30",
                        description: "Photography festival in Sydney - Asia-Pacific market exploration",
                        priority: "optional",
                        website: "https://headon.org.au/",
                        featured: false
                    }
                ]
            },
            4: { // December 2025
                events: []
            },
            5: { // January 2026
                events: []
            },
            6: { // February 2026
                events: [
                ]
            },
            7: { // March 2026
                events: [
                    {
                        id: 'mar1',
                        name: "European Month of Photography",
                        location: "Berlin",
                        date: "March 1-31",
                        description: "Major European photography showcase - perfect for building authority and discovering emerging talent",
                        priority: "key",
                        featured: true,
                        website: "https://emop-berlin.eu/en/about-us/"
                    },
                    {
                        id: 'mar2',
                        name: "Nock Nock",
                        location: "Amsterdam",
                        date: "March 5-8",
                        description: "Contemporary art fair in Amsterdam",
                        priority: "key",
                        website: "https://nocknockart.com/",
                        featured: false
                    },
                    {
                        id: 'mar3',
                        name: "Unseen Photo Fair",
                        location: "Amsterdam",
                        date: "March 2026 (TBC)",
                        description: "International photography fair dedicated to contemporary work",
                        priority: "key",
                        featured: true,
                        website: "https://www.unseenamsterdam.com/"
                    },
                    {
                        id: 'artrot26',
                        name: "Art Rotterdam",
                        location: "Rotterdam",
                        date: "Mar 26-29",
                        description: "Establish Netherlands art fair credibility",
                        priority: "key",
                        featured: false,
                        website: "https://www.artrotterdam.com/"
                    }
                ]
            },
            8: { // April 2026
                events: [
                    {
                        id: 'apr1',
                        name: "Art Cologne",
                        location: "Cologne",
                        date: "Nov 6-9, 2025",
                        description: "German market penetration, art fair",
                        priority: "important",
                        featured: false,
                        website: "https://www.artcologne.com/"
                    },
                    {
                        id: 'apr2',
                        name: "PHotoESPA√ëA",
                        location: "Madrid, Spain",
                        date: "Apr - Sept",
                        description: "International photography festival, one of Europe's most important photography events",
                        priority: "important",
                        featured: true,
                        website: "https://www.phe.es/",
                        multiMonth: [8, 9, 10, 11] // Apr, May, Jun, Jul (continuing into Sept would be next year)
                    }
                ]
            },
            9: { // May 2026
                events: [
                    {
                        id: 'may1',
                        name: "KunstRAI",
                        location: "Amsterdam",
                        date: "Apr 22-26, 2026",
                        description: "Art and antiques fair",
                        priority: "key",
                        featured: false,
                        website: "https://kunstrai.nl/en/"
                    },
                    {
                        id: 'may2',
                        name: "Photo London",
                        location: "London",
                        date: "May 14-17, 2026",
                        description: "Photography fair",
                        priority: "important",
                        featured: false,
                        website: "https://photolondon.org/"
                    }
                ]
            },
            10: { // June 2026
                events: [
                    {
                        id: 'jun1',
                        name: "Art Basel",
                        location: "Basel",
                        date: "June 11-14",
                        description: "Global art market leader",
                        priority: "key",
                        featured: true,
                        website: "https://www.artbasel.com/?lang=en"
                    },
                    {
                        id: 'jun2',
                        name: "Copenhagen Photo Festival",
                        location: "Copenhagen, Denmark",
                        date: "June",
                        description: "Scandinavian photography festival - Nordic market exploration",
                        priority: "optional",
                        featured: false,
                        website: "https://copenhagenphotofestival.com/"
                    }
                ]
            },
            11: { // July 2026
                events: [
                    {
                        id: 'jul1',
                        name: "Les Rencontres de la Photographie",
                        location: "Arles, France",
                        date: "July - Sept",
                        description: "Premier photography festival - the most prestigious photography event in Europe",
                        priority: "key",
                        featured: true,
                        website: "https://www.rencontres-arles.com/",
                        multiMonth: [11] // Jul (extends beyond our calendar range)
                    }
                ]
            }
        }; 

        // Persistence helpers

        // Merge missing fields from defaults into saved data while preserving user edits
        function migrateEventsData(saved, defaults) {
            const result = JSON.parse(JSON.stringify(saved || {}));
            for (let m = 0; m < 12; m++) {
                const defMonth = defaults[m] || {};
                const savedMonth = result[m] || {};
                if (!savedMonth.events) savedMonth.events = [];
                // Index saved events by id for quick lookup
                const savedById = Object.fromEntries((savedMonth.events || []).map(ev => [ev.id, ev]));
                // Ensure planning block is present if missing
                if (defMonth.planning && !savedMonth.planning) {
                    savedMonth.planning = defMonth.planning;
                }
                // Walk default events and merge missing fields into saved events
                (defMonth.events || []).forEach(defEv => {
                    const sEv = savedById[defEv.id];
                    if (sEv) {
                        // Copy any fields that are undefined in saved
                        Object.keys(defEv).forEach(k => {
                            if (sEv[k] === undefined) sEv[k] = defEv[k];
                        });
                    } else {
                        // New event not in saved ‚Äî add it
                        savedMonth.events.push(defEv);
                    }
                });
                result[m] = savedMonth;
            }
            return result;
        }

        function loadEventsData() {
            const saved = localStorage.getItem('ec_events');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    const migrated = migrateEventsData(parsed, defaultEventsData);
                    // Persist migrated structure so future loads have websites/fields
                    localStorage.setItem('ec_events', JSON.stringify(migrated));
                    return migrated;
                } catch (e) {
                    console.warn('Corrupt saved data, falling back to defaults:', e);
                }
            }
            return JSON.parse(JSON.stringify(defaultEventsData));
        }

        function saveEventsData() {
            localStorage.setItem('ec_events', JSON.stringify(eventsData));
        }

        // Working copy of data
        let eventsData = loadEventsData();

        const monthNames = [
            "AUG 2025", "SEP 2025", "OCT 2025", "NOV 2025", "DEC 2025", "JAN 2026",
            "FEB 2026", "MAR 2026", "APR 2026", "MAY 2026", "JUN 2026", "JUL 2026"
        ];

        // Infer multi-month spans from the free-text date string
        function inferMultiMonthFromDate(dateStr) {
            if (!dateStr || typeof dateStr !== 'string') return null;
            const s = dateStr
                .toLowerCase()
                .replace(/[‚Äì‚Äî‚àí]/g, '-') // normalize en/em/minus dashes to hyphen
                .replace(/\s+/g, ' ');
            // Map month tokens to our 0..11 calendar indices starting at Aug 2025
            const tokenToIndex = {
                // Abbreviations
                'aug': 0,
                'sep': 1, 'sept': 1,
                'oct': 2,
                'nov': 3,
                'dec': 4,
                'jan': 5,
                'feb': 6,
                'mar': 7,
                'apr': 8,
                'may': 9,
                'jun': 10,
                'jul': 11,
                // Full names
                'august': 0,
                'september': 1,
                'october': 2,
                'november': 3,
                'december': 4,
                'january': 5,
                'february': 6,
                'march': 7,
                'april': 8,
                'june': 10,
                'july': 11
            };

            const tokens = Object.keys(tokenToIndex);
            const found = [];
            tokens.forEach(t => {
                const idx = s.indexOf(t);
                if (idx !== -1) found.push({ t, pos: idx, m: tokenToIndex[t] });
            });
            if (found.length === 0) return null;
            // Sort by position in string to get chronological order as written
            found.sort((a,b) => a.pos - b.pos);

            const first = found[0].m;
            const last = found[found.length - 1].m;

            // If only one month token, or same month, no span
            if (first === last) return null;

            // If span goes forward within our 0..11 range, return inclusive range
            if (first < last) {
                const span = [];
                for (let m = first; m <= last; m++) span.push(m);
                return span;
            }

            // Handle wrap-around spans (e.g., Nov -> Jan) across our custom window
            // Only support simple three-month wrap like Nov..Jan etc.
            const span = [];
            for (let m = first; m <= 11; m++) span.push(m);
            for (let m = 0; m <= last; m++) span.push(m);
            return span;
        }

        let currentEditingEvent = null;

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';

            // First, collect all events including multi-month events
            const allMonthEvents = {};
            for (let i = 0; i < 12; i++) {
                allMonthEvents[i] = [];
            }

            // Add events to their respective months
            for (let monthIndex in eventsData) {
                const monthData = eventsData[monthIndex];
                if (monthData && monthData.events) {
                    monthData.events.forEach(event => {
                        const inferred = (!event.multiMonth || event.multiMonth.length === 0) ? inferMultiMonthFromDate(event.date) : null;
                        const span = Array.isArray(event.multiMonth) && event.multiMonth.length > 1
                            ? event.multiMonth
                            : (Array.isArray(inferred) && inferred.length > 1 ? inferred : null);

                        if (span) {
                            span.forEach(monthIdx => {
                                if (monthIdx >= 0 && monthIdx < 12) {
                                    allMonthEvents[monthIdx].push({ ...event, isMultiMonth: true });
                                }
                            });
                        } else {
                            // Add to primary month
                            allMonthEvents[monthIndex].push(event);
                        }
                    });
                }
            }

            for (let i = 0; i < 12; i++) {
                const monthColumn = document.createElement('div');
                monthColumn.className = 'month-column';
                
                const header = document.createElement('div');
                header.className = 'month-header';
                header.textContent = monthNames[i];
                
                const content = document.createElement('div');
                content.className = 'month-content';
                
                // Add planning block if exists
                const monthData = eventsData[i];
                if (monthData && monthData.planning) {
                    const planningBlock = document.createElement('div');
                    planningBlock.className = 'planning-block';
                    planningBlock.innerHTML = `
                        <div class="planning-title">${monthData.planning.title}</div>
                        <div class="planning-subtitle">${monthData.planning.subtitle}</div>
                        <div class="planning-details">${monthData.planning.details}</div>
                    `;
                    content.appendChild(planningBlock);
                }

                // Add events for this month
                allMonthEvents[i].forEach(event => {
                    const eventEl = document.createElement('div');
                    eventEl.className = `event ${event.featured ? 'featured-event' : ''} ${event.isMultiMonth ? 'multi-month-event' : ''}`;
                    eventEl.setAttribute('data-priority', event.priority);
                    eventEl.setAttribute('data-event-id', event.id);
                    
                    // Card click always opens the editor
                    eventEl.onclick = () => editEvent(event.id);
                    // Tooltip
                    eventEl.title = 'Click to edit event';
                    
                    eventEl.innerHTML = `
                        ${event.date ? `<div class="event-date">${event.date}</div>` : ''}
                        <div class="event-name">${event.name}${event.isMultiMonth ? ' üîó' : ''}</div>
                        <div class="event-location">${event.location}</div>
                        <div class="event-description">${event.description}</div>
                        ${event.website ? `<a class="event-website" href="${event.website}" target="_blank" rel="noopener noreferrer">üåê ${event.website.replace(/^https?:\/\//, '')}</a>` : ''}
                    `;
                    content.appendChild(eventEl);
                });

                monthColumn.appendChild(header);
                monthColumn.appendChild(content);
                calendar.appendChild(monthColumn);
            }
        }

        function filterEvents(priority) {
            const events = document.querySelectorAll('.event');
            events.forEach(event => {
                if (priority === 'all' || event.getAttribute('data-priority') === priority) {
                    event.style.display = 'block';
                } else {
                    event.style.display = 'none';
                }
            });

            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-filter="${priority}"]`).classList.add('active');
        }

        function openEventModal(eventId = null) {
            const modal = document.getElementById('eventModal');
            const form = document.getElementById('eventForm');
            const deleteBtn = document.getElementById('deleteBtn');
            
            if (eventId) {
                // Edit mode
                currentEditingEvent = eventId;
                const event = findEventById(eventId);
                if (event) {
                    document.getElementById('eventName').value = event.name;
                    document.getElementById('eventLocation').value = event.location;
                    document.getElementById('eventDate').value = event.date || '';
                    document.getElementById('eventMonth').value = findMonthByEventId(eventId);
                    document.getElementById('eventPriority').value = event.priority;
                    document.getElementById('eventWebsite').value = event.website || '';
                    document.getElementById('eventDescription').value = event.description;
                    document.getElementById('eventFeatured').checked = event.featured;
                    deleteBtn.style.display = 'block';
                    document.querySelector('.modal-title').textContent = 'Edit Event';
                }
            } else {
                // Add mode
                currentEditingEvent = null;
                form.reset();
                deleteBtn.style.display = 'none';
                document.querySelector('.modal-title').textContent = 'Add Event';
            }
            
            modal.classList.add('active');
        }

        function closeEventModal() {
            document.getElementById('eventModal').classList.remove('active');
            currentEditingEvent = null;
        }

        function findEventById(eventId) {
            for (let month in eventsData) {
                const event = eventsData[month].events?.find(e => e.id === eventId);
                if (event) return event;
            }
            return null;
        }

        function findMonthByEventId(eventId) {
            for (let month in eventsData) {
                const event = eventsData[month].events?.find(e => e.id === eventId);
                if (event) return month;
            }
            return null;
        }

        function generateEventId() {
            return 'event_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function saveEvent() {
            const name = document.getElementById('eventName').value;
            const location = document.getElementById('eventLocation').value;
            const date = document.getElementById('eventDate').value;
            const month = document.getElementById('eventMonth').value;
            const priority = document.getElementById('eventPriority').value;
            const website = document.getElementById('eventWebsite').value;
            const description = document.getElementById('eventDescription').value;
            const featured = document.getElementById('eventFeatured').checked;

            if (!name || !location || month === '' || !priority) {
                alert('Please fill in all required fields');
                return;
            }

            const eventData = {
                name,
                location,
                date,
                description,
                priority,
                featured
            };

            // Infer multi-month span from the Date field (e.g., "Aug 1 - Oct 12")
            const inferredMulti = inferMultiMonthFromDate(date);
            if (inferredMulti && inferredMulti.length > 1) {
                eventData.multiMonth = inferredMulti;
            } else if (currentEditingEvent) {
                // Preserve existing multiMonth if present and not re-inferred as a span
                const oldMonthKey = findMonthByEventId(currentEditingEvent);
                const existing = eventsData[oldMonthKey]?.events?.find(e => e.id === currentEditingEvent);
                if (existing && Array.isArray(existing.multiMonth)) {
                    eventData.multiMonth = existing.multiMonth;
                }
            }

            // Add website if provided
            if (website) {
                eventData.website = website;
            }

            if (currentEditingEvent) {
                // Edit existing event
                const oldMonth = findMonthByEventId(currentEditingEvent);
                const eventIndex = eventsData[oldMonth].events.findIndex(e => e.id === currentEditingEvent);
                
                if (oldMonth !== month) {
                    // Moving to different month
                    eventsData[oldMonth].events.splice(eventIndex, 1);
                    eventData.id = currentEditingEvent;
                    if (!eventsData[month]) eventsData[month] = { events: [] };
                    if (!eventsData[month].events) eventsData[month].events = [];
                    eventsData[month].events.push(eventData);
                } else {
                    // Same month
                    eventsData[oldMonth].events[eventIndex] = { ...eventsData[oldMonth].events[eventIndex], ...eventData };
                }
            } else {
                // Add new event
                eventData.id = generateEventId();
                if (!eventsData[month]) eventsData[month] = { events: [] };
                if (!eventsData[month].events) eventsData[month].events = [];
                eventsData[month].events.push(eventData);
            }

            // Save to localStorage
            saveEventsData();
            renderCalendar();
            closeEventModal();
        }

        function deleteEvent() {
            if (!currentEditingEvent) return;
            
            if (confirm('Are you sure you want to delete this event?')) {
                const month = findMonthByEventId(currentEditingEvent);
                const eventIndex = eventsData[month].events.findIndex(e => e.id === currentEditingEvent);
                eventsData[month].events.splice(eventIndex, 1);
                
                // Save to localStorage
                saveEventsData();
                renderCalendar();
                closeEventModal();
            }
        }

        function editEvent(eventId) {
            openEventModal(eventId);
        }

        // Export data as JSON file
        function exportData() {
            const dataStr = JSON.stringify(eventsData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'elsewhere-collective-events.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // Reset to default data
        function resetData() {
            if (confirm('Are you sure you want to reset all events to defaults? This will remove any custom events you\'ve added.')) {
                eventsData = JSON.parse(JSON.stringify(defaultEventsData)); // Deep copy
                saveEventsData();
                renderCalendar();
            }
        }

        // Event listeners
        document.getElementById('eventForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveEvent();
        });

        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                filterEvents(this.getAttribute('data-filter'));
            });
        });

        // Close modal when clicking outside
        document.getElementById('eventModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEventModal();
            }
        });

        // Initialize calendar
        renderCalendar();
    </script>
</body>
</html>
